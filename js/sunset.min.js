(function(h){h.fn.pmSunset=function(){var B,C,H=2*Math.PI,l=100*H>>0;C=[];for(var d=-l;d<l;d++)C[d]=Math.sin(0.01*d);B=[];for(d=-l;d<l;d++)B[d]=Math.cos(0.01*d);var I=new Image;I.src="images/postrain_small.jpg";var J=0;return this.each(function(){function d(){f=1;m=0;e=~~(b.width()/f);e=e+e%2+2;n=~~(b.height()/f)+2;b.css("overflow","hidden");a.setAttribute("overflow","hidden");a.setAttribute("width",e+(e>>1));a.setAttribute("height",n);h(a).css("position","relative");h(a).css("left","-"+(b.width()>>
2)+"px");h(a).css("width",b.width()+(b.width()>>1)+"px");h(a).css("height",b.height());w=e>>2;K=w+e;r=0.67*n>>0;x=a.width>>4;rCA=3E-4*(n/3);k=g.getImageData(0,r,a.width,a.height-r);h("#realtimeinfo").html("Actual resolution: "+b.width()+"px x "+b.height()+"px, scaled: "+f+"x, &lt;canvas&gt; resolution: "+e+" x "+n);D=(new Date).getTime();u=0}var a,g,e,n,s,r,m=0,f,k,w,K,x,y,p,z=0,q=0,t,E,D=0,u=0,b=h(this),F=document.createElement("canvas");a=this.appendChild(F);g=a.getContext("2d");x=a.width>>4;b.mousemove(function(c){z=
c.clientX-b.offset().left;q=c.clientY-b.offset().top;a&&(t=z/f+a.width/6,E=q/f,J=-(t>>2)+(t>>3),s=g.createRadialGradient(t,E,0,t,q/f,x),s.addColorStop(0,"rgba(140,120,250,1)"),s.addColorStop(0.5,"rgba(75,60,120,1)"),s.addColorStop(1,"rgba(75,60,120,0)"))});d();setInterval(function(){if(!a)return!1;0===m&&d();var c,b;r=0.67*n>>0;a.setAttribute("width",e+(e>>1));a.setAttribute("height",n);m<l?m++:m=1;g.drawImage(I,J,0);c=g.getImageData(0,0,a.width,r);var f=c.data,q=c.width,G=c.height-1,z=c.width<<2,
F=G>>1;c=60;var M=m<<3,N=m<<3,q=q>>1;p=w<<2;for(var v=G;v>F;v--){c*=0.97;b=v*c+M;for(var L=G-v-1<<2,O=(v+(B[~~(b%l)]*L>>2))*z,P=c-(c>>4),A=w;A<K;A++)b=C[~~(((A-q)*P+N)%l)]*L>>2,y=O+(A+b<<2),k.data[p++]=f[y++],k.data[p++]=f[y++],k.data[p++]=f[y++],k.data[p++]=255;p+=e<<1}s&&(g.fillStyle=s,g.beginPath(),g.arc(t,E,x,0,H,!0),g.closePath(),g.fill());g.putImageData(k,0,r,0,0,k.width,k.height);u++;200<u&&(h("#fps").text("FPS: "+~~(u/(((new Date).getTime()-D)/1E3))),u=0,D=(new Date).getTime())},1)})}})(jQuery);
