(function(h){h.fn.pmSunset=function(){var y,z,A=Math.PI*2,k=A*100>>0;z=[];for(var g=-k;g<k;g++)z[g]=Math.sin(g*0.01);y=[];for(g=-k;g<k;g++)y[g]=Math.cos(g*0.01);return this.each(function(){function I(){l=2;m=0;d=~~(e.width()/l);d=d+d%2+2;f=~~(e.height()/l)+2;e.css("overflow","hidden");a.setAttribute("overflow","hidden");a.setAttribute("width",d+(d>>1));a.setAttribute("height",f);h(a).css("position","relative");h(a).css("left","-"+(e.width()>>2)+"px");h(a).css("width",e.width()+(e.width()>>1)+"px");
h(a).css("height",e.height());s=d>>2;J=s+d;i=f*0.67>>0;t=a.width>>5;n=b.createLinearGradient((a.width/2>>0)+1,0,(a.width/2>>0)+1,i);n.addColorStop(0,"#330044");n.addColorStop(0.75,"#66223a");n.addColorStop(0.9,"#883333");n.addColorStop(1,"#ee4422");B=a.width/4;bggradsun=b.createRadialGradient(a.width*0.4,f*0.72,0,a.width*0.4,f*0.72,B);bggradsun.addColorStop(0,"rgba(255,230,40,1)");bggradsun.addColorStop(0.12,"rgba(255,200,40,1)");bggradsun.addColorStop(0.3,"rgba(255,160,20,0.3)");bggradsun.addColorStop(1,
"rgba(255,100,10,0)");rCA=3.0E-4*(f/3);j=b.getImageData(0,i,a.width,a.height-i);h("#realtimeinfo").html("Actual resolution: "+e.width()+"px x "+e.height()+"px, scaled: "+l+"x, &lt;canvas&gt; resolution: "+d+" x "+f);C=(new Date).getTime();q=0}var a,b,d,f,n,o,i,m=0,l,j,s,J,B,t,u,p,K=0,D=0,v,E,C=0,q=0,e=h(this);a=this.appendChild(document.createElement("canvas"));b=a.getContext("2d");e.mousemove(function(c){K=c.clientX-e.offset().left;D=c.clientY-e.offset().top;if(a){v=K/l+a.width/6;E=D/l;t=a.width>>
4;o=b.createRadialGradient(v,E,0,v,D/l,t);o.addColorStop(0,"rgba(140,120,250,1)");o.addColorStop(0.5,"rgba(75,60,120,1)");o.addColorStop(1,"rgba(75,60,120,0)")}});I();setInterval(function(){if(!a)return false;m===0&&I();var c,w;i=f*0.67>>0;a.setAttribute("width",d+(d>>1));a.setAttribute("height",f);m<k?m++:m=1;b.fillStyle=n;b.fillRect(0,0,a.width,i);b.fillStyle=bggradsun;b.beginPath();b.arc(a.width*0.4,f*0.72,B,0,A,true);b.closePath();b.fill();if(o){b.fillStyle=o;b.beginPath();b.arc(v,E,t,0,A,true);
b.closePath();b.fill()}c=b.getImageData(0,0,a.width,i);var F=c.data,G=c.width,H=c.height-1,M=c.width<<2,N=H>>1;c=50;var O=m<<3,P=m<<3;G=G>>1;p=s<<2;for(var r=H;r>N;r--){c*=0.95;w=r*c+O;for(var L=H-r-1<<2,Q=(r+(y[~~(w%k)]*L>>2))*M,R=c-(c>>4),x=s;x<J;x++){w=z[~~(((x-G)*R+P)%k)]*L>>2;u=Q+(x+w<<2);j.data[p++]=F[u++];j.data[p++]=F[u++];j.data[p++]=F[u++];j.data[p++]=255}p+=d<<1}b.putImageData(j,0,i,0,0,j.width,j.height);q++;if(q>200){h("#fps").text("FPS: "+~~(q/(((new Date).getTime()-C)/1E3)));q=0;C=(new Date).getTime()}},
1)})}})(jQuery);
